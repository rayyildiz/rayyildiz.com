---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { isLangPost } from '../../../lib/content';
import { slugifyTerm } from '../../../lib/slug';

const posts = (await getCollection('posts')).filter((p) => isLangPost('tr', p));

const counts = new Map<string, { label: string; count: number }>();
for (const p of posts) {
  for (const cat of p.data.categories ?? []) {
    const key = slugifyTerm(cat);
    if (!key) continue;
    const prev = counts.get(key);
    counts.set(key, { label: cat, count: (prev?.count ?? 0) + 1 });
  }
}

const categories = Array.from(counts.entries())
  .map(([slug, v]) => ({ slug, ...v }))
  .sort((a, b) => a.slug.localeCompare(b.slug));
---

<BaseLayout lang="tr" title="Kategoriler">
  <h1 class="text-2xl font-semibold">Kategoriler</h1>
  <ul class="mt-6 grid gap-2 sm:grid-cols-2">
    {categories.map((c) => (
      <li>
        <a class="hover:underline" href={`/tr/categories/${c.slug}/`}>{c.label}</a>
        <span class="text-sm text-slate-500"> ({c.count})</span>
      </li>
    ))}
  </ul>
</BaseLayout>
